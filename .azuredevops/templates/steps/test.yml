parameters:
- name: componentName
  type: string
  default: ''
- name: testDir
  type: string
  default: 'build'
- name: testExecutable
  type: string
  default: 'ctest'
- name: testParameters
  type: string
  default: '--output-on-failure --output-junit test_output.xml'

steps:
# run test, continue on failure to publish results
# and to publish build artifacts
- task: Bash@3
  displayName: '${{ parameters.componentName }} Test'
  continueOnError: true
  inputs:
    targetType: inline
    script: ${{ parameters.testBinary }} ${{ parameters.testParameters }}
    workingDirectory: ${{ parameters.testDir }}
- task: PublishTestResults@2
  displayName: 'Results'
  inputs:
    testResultsFormat: 'junit'
    testResultsFiles: '**/test_output.xml'
  condition: succeededOrFailed()
